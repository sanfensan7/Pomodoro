<view class="container" style="--theme-color: {{themeColor}}">
  <view class="header">
    <navigator url="/pages/focus/focus" open-type="navigate" hover-class="none">
      <view class="back-icon">
        <image src="/images/back.png" mode="aspectFit"></image>
      </view>
    </navigator>
    <text class="title">ç»Ÿè®¡</text>
  </view>
  
  <view class="period-tabs">
    <view class="period-tab {{period === 'day' ? 'active' : ''}}" 
          style="{{period === 'day' ? 'background-color:' + themeColor : ''}}"
          data-period="day" bindtap="switchPeriod">æ—¥</view>
    <view class="period-tab {{period === 'week' ? 'active' : ''}}" 
          style="{{period === 'week' ? 'background-color:' + themeColor : ''}}"
          data-period="week" bindtap="switchPeriod">å‘¨</view>
    <view class="period-tab {{period === 'month' ? 'active' : ''}}" 
          style="{{period === 'month' ? 'background-color:' + themeColor : ''}}"
          data-period="month" bindtap="switchPeriod">æœˆ</view>
    <view class="period-tab {{period === 'ranking' ? 'active' : ''}}" 
          style="{{period === 'ranking' ? 'background-color:' + themeColor : ''}}"
          data-period="ranking" bindtap="switchPeriod">æ’è¡Œæ¦œ</view>
  </view>
  
  <!-- ç»Ÿè®¡å›¾è¡¨ -->
  <view class="chart-container" wx:if="{{period !== 'ranking'}}">
    <view class="chart">
      <view class="chart-bars">
        <block wx:for="{{chartData.labels}}" wx:key="index">
          <view class="chart-bar-container">
            <view class="chart-bar" style="height: {{chartData.heights[index]}}rpx; background-color: {{themeColor}}"></view>
            <view class="chart-label">{{item}}</view>
          </view>
        </block>
      </view>
    </view>
  </view>
  
  <view class="stats-summary" wx:if="{{period !== 'ranking'}}">
    <view class="summary-item">
      <view class="summary-label">
        <block wx:if="{{period === 'day'}}">ä»Šæ—¥ä¸“æ³¨æ¬¡æ•°ï¼š</block>
        <block wx:elif="{{period === 'week'}}">æœ¬å‘¨ä¸“æ³¨æ¬¡æ•°ï¼š</block>
        <block wx:else>æœ¬æœˆä¸“æ³¨æ¬¡æ•°ï¼š</block>
      </view>
      <view class="summary-value" style="color: {{themeColor}}">{{currentStats.count}}</view>
    </view>
    
    <view class="summary-item">
      <view class="summary-label">
        <block wx:if="{{period === 'day'}}">ä»Šæ—¥ä¸“æ³¨æ—¶é•¿ï¼š</block>
        <block wx:elif="{{period === 'week'}}">æœ¬å‘¨ä¸“æ³¨æ—¶é•¿ï¼š</block>
        <block wx:else>æœ¬æœˆä¸“æ³¨æ—¶é•¿ï¼š</block>
      </view>
      <view class="summary-value" style="color: {{themeColor}}">{{currentStats.duration}}</view>
    </view>
    
    <view class="summary-item">
      <view class="summary-label">
        <block wx:if="{{period === 'day'}}">å¹³å‡æ¯å°æ—¶ï¼š</block>
        <block wx:else>å¹³å‡æ¯æ—¥ï¼š</block>
      </view>
      <view class="summary-value" style="color: {{themeColor}}">{{currentStats.average}}</view>
    </view>
    
    <view class="summary-item">
      <view class="summary-label">æœ€é•¿è¿ç»­ä¸“æ³¨ï¼š</view>
      <view class="summary-value" style="color: {{themeColor}}">{{currentStats.longest}}</view>
    </view>
  </view>

  <!-- æ’è¡Œæ¦œå†…å®¹ -->
  <view class="ranking-container" wx:if="{{period === 'ranking'}}">
    <!-- æ¨¡æ‹Ÿæ•°æ®æç¤º -->
    <view class="mock-data-banner">
      <text class="banner-icon">â„¹ï¸</text>
      <view class="banner-content">
        <text class="banner-title">å½“å‰ä¸ºæ¨¡æ‹Ÿæ•°æ®</text>
        <text class="banner-desc">æš‚æœªå¼€é€šäº‘å¼€å‘ï¼Œå±•ç¤ºçš„æ˜¯æµ‹è¯•æ•°æ®</text>
      </view>
    </view>

    <!-- æˆ‘çš„æ•°æ®å¡ç‰‡ -->
    <view class="my-stats-card">
      <view class="stats-header">
        <view class="rank-badge">
          <text class="rank-text">ç¬¬{{myStats.rank || '--'}}å</text>
        </view>
      </view>
      
      <view class="stats-content">
        <view class="stat-item">
          <text class="stat-label">æœ¬å‘¨ä¸“æ³¨</text>
          <text class="stat-value">{{myStats.weekHours}}å°æ—¶</text>
          <text class="stat-sub">{{myStats.weekSessions}}æ¬¡</text>
        </view>
        
        <view class="stat-divider"></view>
        
        <view class="stat-item">
          <text class="stat-label">ç´¯è®¡ä¸“æ³¨</text>
          <text class="stat-value">{{myStats.totalHours}}å°æ—¶</text>
          <text class="stat-sub">{{myStats.consecutiveDays}}å¤©è¿ç»­</text>
        </view>
      </view>
      
      <!-- æœ¬å‘¨æ¯å¤©æ•°æ® -->
      <view class="weekly-chart">
        <view class="chart-title">æœ¬å‘¨ä¸“æ³¨æƒ…å†µ</view>
        <view class="chart-bars-ranking">
          <view class="bar-item" wx:for="{{weeklyData}}" wx:key="day">
            <view class="bar-container">
              <view class="bar-fill" 
                    style="height: {{item.minutes > 0 ? (item.minutes / 180 * 100) : 5}}%; background-color: {{themeColor}}">
              </view>
            </view>
            <text class="bar-label">{{item.day}}</text>
            <text class="bar-value">{{item.hours}}h</text>
          </view>
        </view>
      </view>
    </view>

    <!-- æ’è¡Œæ¦œç±»å‹åˆ‡æ¢ -->
    <view class="ranking-tabs">
      <view class="tab-item {{rankingType === 'week' ? 'active' : ''}}" 
            bindtap="switchRankingType" 
            data-type="week"
            style="{{rankingType === 'week' ? 'background-color:' + themeColor : ''}}">
        <text>æœ¬å‘¨æ’è¡Œ</text>
      </view>
      <view class="tab-item {{rankingType === 'total' ? 'active' : ''}}" 
            bindtap="switchRankingType" 
            data-type="total"
            style="{{rankingType === 'total' ? 'background-color:' + themeColor : ''}}">
        <text>æ€»æ’è¡Œ</text>
      </view>
    </view>

    <!-- æ’è¡Œæ¦œåˆ—è¡¨ -->
    <view class="ranking-list" wx:if="{{!loading}}">
      <view class="ranking-item {{item.isMe ? 'me' : ''}}" 
            wx:for="{{rankingList}}" 
            wx:key="rank">
        <!-- æ’å -->
        <view class="rank-number {{item.rank <= 3 ? 'top-' + item.rank : ''}}">
          <text wx:if="{{item.rank <= 3}}">{{item.rank === 1 ? 'ğŸ¥‡' : item.rank === 2 ? 'ğŸ¥ˆ' : 'ğŸ¥‰'}}</text>
          <text wx:else>{{item.rank}}</text>
        </view>
        
        <!-- å¤´åƒå’Œæ˜µç§° -->
        <view class="user-info">
          <image class="avatar" src="{{item.avatarUrl}}" mode="aspectFill"></image>
          <text class="nickname">{{item.nickname}}</text>
          <text class="me-tag" wx:if="{{item.isMe}}">æˆ‘</text>
        </view>
        
        <!-- æ•°æ® -->
        <view class="user-stats">
          <text class="main-stat">
            {{rankingType === 'week' ? item.weekHours : item.totalHours}}å°æ—¶
          </text>
          <text class="sub-stat">
            {{rankingType === 'week' ? 'æœ¬å‘¨' : 'ç´¯è®¡'}}
          </text>
        </view>
      </view>
      
      <!-- ç©ºçŠ¶æ€ -->
      <view class="empty-state" wx:if="{{rankingList.length === 0}}">
        <view class="empty-icon">ğŸ†</view>
        <text class="empty-text">æš‚æ— æ’è¡Œæ•°æ®</text>
        <text class="empty-hint">é‚€è¯·å¥½å‹ä¸€èµ·ä¸“æ³¨å§</text>
      </view>
    </view>

    <!-- åŠ è½½çŠ¶æ€ -->
    <view class="loading-state" wx:if="{{loading}}">
      <view class="loading-spinner"></view>
      <text>åŠ è½½ä¸­...</text>
    </view>

    <!-- è¯´æ˜ -->
    <view class="ranking-notice">
      <text class="notice-icon">ğŸ’¡</text>
      <text class="notice-text">å½“å‰ä¸ºæ¨¡æ‹Ÿæ•°æ®å±•ç¤ºï¼Œæš‚æœªå¼€é€šäº‘å¼€å‘åŠŸèƒ½ã€‚çœŸå®å¥½å‹æ’è¡Œæ¦œéœ€é…ç½®å¾®ä¿¡äº‘å¼€å‘åæ–¹å¯ä½¿ç”¨ã€‚</text>
    </view>
  </view>
</view> 