<view class="container" style="--theme-color: {{themeColor}}">
  <view class="header">
    <navigator url="/pages/focus/focus" open-type="navigate" hover-class="none">
      <view class="back-icon">
        <image src="/images/back.png" mode="aspectFit"></image>
      </view>
    </navigator>
    <text class="title">统计</text>
  </view>
  
  <view class="period-tabs">
    <view class="period-tab {{period === 'day' ? 'active' : ''}}" 
          style="{{period === 'day' ? 'background-color:' + themeColor : ''}}"
          data-period="day" bindtap="switchPeriod">日</view>
    <view class="period-tab {{period === 'week' ? 'active' : ''}}" 
          style="{{period === 'week' ? 'background-color:' + themeColor : ''}}"
          data-period="week" bindtap="switchPeriod">周</view>
    <view class="period-tab {{period === 'month' ? 'active' : ''}}" 
          style="{{period === 'month' ? 'background-color:' + themeColor : ''}}"
          data-period="month" bindtap="switchPeriod">月</view>
    <view class="period-tab {{period === 'ranking' ? 'active' : ''}}" 
          style="{{period === 'ranking' ? 'background-color:' + themeColor : ''}}"
          data-period="ranking" bindtap="switchPeriod">排行榜</view>
  </view>
  
  <!-- 统计图表 -->
  <view class="chart-container" wx:if="{{period !== 'ranking'}}">
    <view class="chart">
      <view class="chart-bars">
        <block wx:for="{{chartData.labels}}" wx:key="index">
          <view class="chart-bar-container">
            <view class="chart-bar" style="height: {{chartData.heights[index]}}rpx; background-color: {{themeColor}}"></view>
            <view class="chart-label">{{item}}</view>
          </view>
        </block>
      </view>
    </view>
  </view>
  
  <view class="stats-summary" wx:if="{{period !== 'ranking'}}">
    <view class="summary-item">
      <view class="summary-label">
        <block wx:if="{{period === 'day'}}">今日专注次数：</block>
        <block wx:elif="{{period === 'week'}}">本周专注次数：</block>
        <block wx:else>本月专注次数：</block>
      </view>
      <view class="summary-value" style="color: {{themeColor}}">{{currentStats.count}}</view>
    </view>
    
    <view class="summary-item">
      <view class="summary-label">
        <block wx:if="{{period === 'day'}}">今日专注时长：</block>
        <block wx:elif="{{period === 'week'}}">本周专注时长：</block>
        <block wx:else>本月专注时长：</block>
      </view>
      <view class="summary-value" style="color: {{themeColor}}">{{currentStats.duration}}</view>
    </view>
    
    <view class="summary-item">
      <view class="summary-label">
        <block wx:if="{{period === 'day'}}">平均每小时：</block>
        <block wx:else>平均每日：</block>
      </view>
      <view class="summary-value" style="color: {{themeColor}}">{{currentStats.average}}</view>
    </view>
    
    <view class="summary-item">
      <view class="summary-label">最长连续专注：</view>
      <view class="summary-value" style="color: {{themeColor}}">{{currentStats.longest}}</view>
    </view>
  </view>

  <!-- 排行榜内容 -->
  <view class="ranking-container" wx:if="{{period === 'ranking'}}">
    <!-- 模拟数据提示 -->
    <view class="mock-data-banner">
      <text class="banner-icon">ℹ️</text>
      <view class="banner-content">
        <text class="banner-title">当前为模拟数据</text>
        <text class="banner-desc">暂未开通云开发，展示的是测试数据</text>
      </view>
    </view>

    <!-- 我的数据卡片 -->
    <view class="my-stats-card">
      <view class="stats-header">
        <view class="rank-badge">
          <text class="rank-text">第{{myStats.rank || '--'}}名</text>
        </view>
      </view>
      
      <view class="stats-content">
        <view class="stat-item">
          <text class="stat-label">本周专注</text>
          <text class="stat-value">{{myStats.weekHours}}小时</text>
          <text class="stat-sub">{{myStats.weekSessions}}次</text>
        </view>
        
        <view class="stat-divider"></view>
        
        <view class="stat-item">
          <text class="stat-label">累计专注</text>
          <text class="stat-value">{{myStats.totalHours}}小时</text>
          <text class="stat-sub">{{myStats.consecutiveDays}}天连续</text>
        </view>
      </view>
      
      <!-- 本周每天数据 -->
      <view class="weekly-chart">
        <view class="chart-title">本周专注情况</view>
        <view class="chart-bars-ranking">
          <view class="bar-item" wx:for="{{weeklyData}}" wx:key="day">
            <view class="bar-container">
              <view class="bar-fill" 
                    style="height: {{item.minutes > 0 ? (item.minutes / 180 * 100) : 5}}%; background-color: {{themeColor}}">
              </view>
            </view>
            <text class="bar-label">{{item.day}}</text>
            <text class="bar-value">{{item.hours}}h</text>
          </view>
        </view>
      </view>
    </view>

    <!-- 排行榜类型切换 -->
    <view class="ranking-tabs">
      <view class="tab-item {{rankingType === 'week' ? 'active' : ''}}" 
            bindtap="switchRankingType" 
            data-type="week"
            style="{{rankingType === 'week' ? 'background-color:' + themeColor : ''}}">
        <text>本周排行</text>
      </view>
      <view class="tab-item {{rankingType === 'total' ? 'active' : ''}}" 
            bindtap="switchRankingType" 
            data-type="total"
            style="{{rankingType === 'total' ? 'background-color:' + themeColor : ''}}">
        <text>总排行</text>
      </view>
    </view>

    <!-- 排行榜列表 -->
    <view class="ranking-list" wx:if="{{!loading}}">
      <view class="ranking-item {{item.isMe ? 'me' : ''}}" 
            wx:for="{{rankingList}}" 
            wx:key="rank">
        <!-- 排名 -->
        <view class="rank-number {{item.rank <= 3 ? 'top-' + item.rank : ''}}">
          <text wx:if="{{item.rank <= 3}}">{{item.rank === 1 ? '🥇' : item.rank === 2 ? '🥈' : '🥉'}}</text>
          <text wx:else>{{item.rank}}</text>
        </view>
        
        <!-- 头像和昵称 -->
        <view class="user-info">
          <image class="avatar" src="{{item.avatarUrl}}" mode="aspectFill"></image>
          <text class="nickname">{{item.nickname}}</text>
          <text class="me-tag" wx:if="{{item.isMe}}">我</text>
        </view>
        
        <!-- 数据 -->
        <view class="user-stats">
          <text class="main-stat">
            {{rankingType === 'week' ? item.weekHours : item.totalHours}}小时
          </text>
          <text class="sub-stat">
            {{rankingType === 'week' ? '本周' : '累计'}}
          </text>
        </view>
      </view>
      
      <!-- 空状态 -->
      <view class="empty-state" wx:if="{{rankingList.length === 0}}">
        <view class="empty-icon">🏆</view>
        <text class="empty-text">暂无排行数据</text>
        <text class="empty-hint">邀请好友一起专注吧</text>
      </view>
    </view>

    <!-- 加载状态 -->
    <view class="loading-state" wx:if="{{loading}}">
      <view class="loading-spinner"></view>
      <text>加载中...</text>
    </view>

    <!-- 说明 -->
    <view class="ranking-notice">
      <text class="notice-icon">💡</text>
      <text class="notice-text">当前为模拟数据展示，暂未开通云开发功能。真实好友排行榜需配置微信云开发后方可使用。</text>
    </view>
  </view>
</view> 