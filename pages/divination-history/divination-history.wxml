<view class="container" style="--theme-color: {{themeColor}}">
  <view class="header">
    <navigator url="/pages/divination/divination" open-type="navigateBack" hover-class="none">
      <view class="back-icon">
        <image src="/images/back.png" mode="aspectFit"></image>
      </view>
    </navigator>
    <text class="title">ç®—å‘½è®°å½•</text>
    <view class="clear-btn" bindtap="clearAllRecords">
      <text>ğŸ—‘ï¸</text>
    </view>
  </view>

  <view class="content">
    <!-- è®°å½•åˆ—è¡¨ -->
    <view class="records-list" wx:if="{{records.length > 0}}">
      <block wx:for="{{records}}" wx:key="timestamp">
        <view class="record-item">
          <view class="record-header" bindtap="viewDetail" data-index="{{index}}">
            <view class="record-info">
              <view class="record-question">{{item.userInfo.question}}</view>
              <view class="record-meta">
                <text class="record-name">{{item.userInfo.name}}</text>
                <text class="record-time">{{item.timestamp}}</text>
              </view>
            </view>
            <view class="record-arrow">
              <text>ğŸ‘ï¸</text>
            </view>
          </view>
          
          <view class="record-summary">
            <text>{{item.summary}}</text>
          </view>

          <view class="record-actions">
            <view class="action-btn share" bindtap="shareRecord" data-index="{{index}}">
              <text>ğŸ“¤ åˆ†äº«</text>
            </view>
            <view class="action-btn delete" bindtap="deleteRecord" data-index="{{index}}">
              <text>ğŸ—‘ï¸ åˆ é™¤</text>
            </view>
          </view>
        </view>
      </block>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{records.length === 0}}">
      <view class="empty-icon">ğŸ”®</view>
      <view class="empty-title">æš‚æ— ç®—å‘½è®°å½•</view>
      <view class="empty-desc">å¿«å»ç®—ä¸€å¦ï¼Œæ¢ç´¢å‘½è¿çš„å¥¥ç§˜å§ï¼</view>
      <button class="go-divination-btn" bindtap="goToDivination">
        ç«‹å³ç®—å‘½
      </button>
    </view>
  </view>

  <!-- è¯¦æƒ…å¼¹çª— -->
  <view class="detail-modal" wx:if="{{showDetail && selectedRecord}}">
    <view class="modal-mask" bindtap="closeDetail"></view>
    <view class="modal-content">
      <view class="modal-header">
        <view class="modal-title">ç®—å‘½è¯¦æƒ…</view>
        <view class="modal-close" bindtap="closeDetail">âœ•</view>
      </view>

      <scroll-view class="modal-body" scroll-y="true">
        <view class="detail-section">
          <view class="detail-label">åŸºæœ¬ä¿¡æ¯</view>
          <view class="detail-info">
            <text>å§“åï¼š{{selectedRecord.userInfo.name}}</text>
            <text>æ€§åˆ«ï¼š{{selectedRecord.userInfo.gender === 'male' ? 'ç”·' : 'å¥³'}}</text>
            <text>å‡ºç”Ÿï¼š{{selectedRecord.userInfo.birthDate}}</text>
            <text>æ—¶è¾°ï¼š{{selectedRecord.userInfo.birthTime}}</text>
          </view>
        </view>

        <view class="detail-section">
          <view class="detail-label">å åœé—®é¢˜</view>
          <view class="detail-content">
            <text>{{selectedRecord.userInfo.question}}</text>
          </view>
        </view>

        <!-- å…«å­—å‘½ç† -->
        <view class="detail-section" wx:if="{{selectedRecord.content.bazi}}">
          <view class="detail-label">å…«å­—å‘½ç†</view>
          <view class="detail-content">
            <text>{{selectedRecord.content.bazi}}</text>
          </view>
        </view>

        <!-- é—®é¢˜åˆ†æ -->
        <view class="detail-section" wx:if="{{selectedRecord.content.analysis}}">
          <view class="detail-label">é—®é¢˜åˆ†æ</view>
          <view class="detail-content">
            <text>{{selectedRecord.content.analysis}}</text>
          </view>
        </view>

        <!-- æœ‰åˆ©å› ç´  -->
        <view class="detail-section" wx:if="{{selectedRecord.content.advantages}}">
          <view class="detail-label">æœ‰åˆ©å› ç´ </view>
          <view class="detail-content">
            <text>{{selectedRecord.content.advantages}}</text>
          </view>
        </view>

        <!-- æ³¨æ„äº‹é¡¹ -->
        <view class="detail-section" wx:if="{{selectedRecord.content.challenges}}">
          <view class="detail-label">æ³¨æ„äº‹é¡¹</view>
          <view class="detail-content">
            <text>{{selectedRecord.content.challenges}}</text>
          </view>
        </view>

        <!-- æ”¹å–„å»ºè®® -->
        <view class="detail-section" wx:if="{{selectedRecord.content.suggestions}}">
          <view class="detail-label">æ”¹å–„å»ºè®®</view>
          <view class="detail-content">
            <text>{{selectedRecord.content.suggestions}}</text>
          </view>
        </view>

        <!-- æ€»ä½“è¿åŠ¿ -->
        <view class="detail-section" wx:if="{{selectedRecord.content.overall}}">
          <view class="detail-label">æ€»ä½“è¿åŠ¿</view>
          <view class="detail-content">
            <text>{{selectedRecord.content.overall}}</text>
          </view>
        </view>

        <view class="detail-section summary-section">
          <view class="detail-label">æ€»ç»“</view>
          <view class="detail-content summary">
            <text>{{selectedRecord.summary}}</text>
          </view>
        </view>
      </scroll-view>
    </view>
  </view>
</view>
