<view class="container" style="--theme-color: {{themeColor}}">
  <view class="header">
    <navigator url="/pages/divination/divination" open-type="navigateBack" hover-class="none">
      <view class="back-icon">
        <image src="/images/back.png" mode="aspectFit"></image>
      </view>
    </navigator>
    <text class="title">算命记录</text>
    <view class="clear-btn" bindtap="clearAllRecords">
      <text>🗑️</text>
    </view>
  </view>

  <view class="content">
    <!-- 记录列表 -->
    <view class="records-list" wx:if="{{records.length > 0}}">
      <block wx:for="{{records}}" wx:key="timestamp">
        <view class="record-item">
          <view class="record-header" bindtap="viewDetail" data-index="{{index}}">
            <view class="record-info">
              <view class="record-question">{{item.userInfo.question}}</view>
              <view class="record-meta">
                <text class="record-name">{{item.userInfo.name}}</text>
                <text class="record-time">{{item.timestamp}}</text>
              </view>
            </view>
            <view class="record-arrow">
              <text>👁️</text>
            </view>
          </view>
          
          <view class="record-summary">
            <text>{{item.summary}}</text>
          </view>

          <view class="record-actions">
            <view class="action-btn share" bindtap="shareRecord" data-index="{{index}}">
              <text>📤 分享</text>
            </view>
            <view class="action-btn delete" bindtap="deleteRecord" data-index="{{index}}">
              <text>🗑️ 删除</text>
            </view>
          </view>
        </view>
      </block>
    </view>

    <!-- 空状态 -->
    <view class="empty-state" wx:if="{{records.length === 0}}">
      <view class="empty-icon">🔮</view>
      <view class="empty-title">暂无算命记录</view>
      <view class="empty-desc">快去算一卦，探索命运的奥秘吧！</view>
      <button class="go-divination-btn" bindtap="goToDivination">
        立即算命
      </button>
    </view>
  </view>

  <!-- 详情弹窗 -->
  <view class="detail-modal" wx:if="{{showDetail && selectedRecord}}">
    <view class="modal-mask" bindtap="closeDetail"></view>
    <view class="modal-content">
      <view class="modal-header">
        <view class="modal-title">算命详情</view>
        <view class="modal-close" bindtap="closeDetail">✕</view>
      </view>

      <scroll-view class="modal-body" scroll-y="true">
        <view class="detail-section">
          <view class="detail-label">基本信息</view>
          <view class="detail-info">
            <text>姓名：{{selectedRecord.userInfo.name}}</text>
            <text>性别：{{selectedRecord.userInfo.gender === 'male' ? '男' : '女'}}</text>
            <text>出生：{{selectedRecord.userInfo.birthDate}}</text>
            <text>时辰：{{selectedRecord.userInfo.birthTime}}</text>
          </view>
        </view>

        <view class="detail-section">
          <view class="detail-label">占卜问题</view>
          <view class="detail-content">
            <text>{{selectedRecord.userInfo.question}}</text>
          </view>
        </view>

        <!-- 八字命理 -->
        <view class="detail-section" wx:if="{{selectedRecord.content.bazi}}">
          <view class="detail-label">八字命理</view>
          <view class="detail-content">
            <text>{{selectedRecord.content.bazi}}</text>
          </view>
        </view>

        <!-- 问题分析 -->
        <view class="detail-section" wx:if="{{selectedRecord.content.analysis}}">
          <view class="detail-label">问题分析</view>
          <view class="detail-content">
            <text>{{selectedRecord.content.analysis}}</text>
          </view>
        </view>

        <!-- 有利因素 -->
        <view class="detail-section" wx:if="{{selectedRecord.content.advantages}}">
          <view class="detail-label">有利因素</view>
          <view class="detail-content">
            <text>{{selectedRecord.content.advantages}}</text>
          </view>
        </view>

        <!-- 注意事项 -->
        <view class="detail-section" wx:if="{{selectedRecord.content.challenges}}">
          <view class="detail-label">注意事项</view>
          <view class="detail-content">
            <text>{{selectedRecord.content.challenges}}</text>
          </view>
        </view>

        <!-- 改善建议 -->
        <view class="detail-section" wx:if="{{selectedRecord.content.suggestions}}">
          <view class="detail-label">改善建议</view>
          <view class="detail-content">
            <text>{{selectedRecord.content.suggestions}}</text>
          </view>
        </view>

        <!-- 总体运势 -->
        <view class="detail-section" wx:if="{{selectedRecord.content.overall}}">
          <view class="detail-label">总体运势</view>
          <view class="detail-content">
            <text>{{selectedRecord.content.overall}}</text>
          </view>
        </view>

        <view class="detail-section summary-section">
          <view class="detail-label">总结</view>
          <view class="detail-content summary">
            <text>{{selectedRecord.summary}}</text>
          </view>
        </view>
      </scroll-view>
    </view>
  </view>
</view>
