<view class="container" style="--theme-color: {{themeColor}}">
  <view class="header">
    <navigator url="/pages/settings/settings" open-type="navigateBack" hover-class="none">
      <view class="back-icon">
        <image src="/images/back.png" mode="aspectFit"></image>
      </view>
    </navigator>
    <text class="title">æ‹¼å›¾æ¸¸æˆ</text>
    <view class="placeholder"></view>
  </view>

  <!-- æ¸¸æˆèœå• -->
  <view class="game-menu" wx:if="{{gameState === 'menu'}}">
    <view class="menu-header">
      <view class="game-icon">ğŸ§©</view>
      <view class="game-title">æ•°å­—æ‹¼å›¾</view>
      <view class="game-desc">ç§»åŠ¨æ•°å­—æ–¹å—ï¼ŒæŒ‰é¡ºåºæ’åˆ—å®Œæˆæ‹¼å›¾</view>
    </view>

    <view class="difficulty-section">
      <view class="section-title">é€‰æ‹©éš¾åº¦</view>
      <view class="difficulty-options">
        <block wx:for="{{difficultyOptions}}" wx:key="value">
          <view class="difficulty-item {{difficulty === item.value ? 'active' : ''}}"
                bindtap="selectDifficulty"
                data-difficulty="{{item.value}}">
            <view class="difficulty-label">{{item.label}}</view>
            <view class="difficulty-record" wx:if="{{bestRecords[item.value].moves}}">
              <text class="record-text">æœ€ä½³ï¼š{{bestRecords[item.value].moves}}æ­¥</text>
            </view>
          </view>
        </block>
      </view>
    </view>

    <button class="start-btn" bindtap="startGame">
      å¼€å§‹æ¸¸æˆ
    </button>

    <view class="records-section">
      <view class="section-title">æœ€ä½³è®°å½•</view>
      <view class="records-list">
        <block wx:for="{{difficultyOptions}}" wx:key="value">
          <view class="record-item">
            <view class="record-difficulty">{{item.label}}</view>
            <view class="record-stats" wx:if="{{bestRecords[item.value].moves}}">
              <text class="record-moves">{{bestRecords[item.value].moves}}æ­¥</text>
              <text class="record-time">{{bestRecords[item.value].time}}ç§’</text>
            </view>
            <view class="record-stats" wx:else>
              <text class="no-record">æš‚æ— è®°å½•</text>
            </view>
          </view>
        </block>
      </view>
    </view>
  </view>

  <!-- æ¸¸æˆç•Œé¢ -->
  <view class="game-playing" wx:if="{{gameState === 'playing'}}">
    <view class="game-info">
      <view class="info-item">
        <view class="info-label">æ­¥æ•°</view>
        <view class="info-value">{{moves}}</view>
      </view>
      <view class="info-item">
        <view class="info-label">æ—¶é—´</view>
        <view class="info-value">{{gameTime}}s</view>
      </view>
      <view class="info-item">
        <view class="info-label">éš¾åº¦</view>
        <view class="info-value">{{puzzleSize}}Ã—{{puzzleSize}}</view>
      </view>
    </view>

    <view class="puzzle-container">
      <view class="puzzle-grid" style="grid-template-columns: repeat({{puzzleSize}}, 1fr);">
        <block wx:for="{{puzzleGrid}}" wx:for-index="rowIndex" wx:key="rowIndex">
          <block wx:for="{{item}}" wx:for-index="colIndex" wx:for-item="cellValue" wx:key="colIndex">
            <view class="puzzle-tile {{cellValue === 0 ? 'empty' : ''}}"
                  bindtap="moveTile"
                  data-row="{{rowIndex}}"
                  data-col="{{colIndex}}">
              <text wx:if="{{cellValue !== 0}}">{{cellValue}}</text>
            </view>
          </block>
        </block>
      </view>
    </view>

    <view class="game-controls">
      <view class="control-row">
        <button class="control-btn secondary" bindtap="pauseGame">
          {{isGameActive ? 'æš‚åœ' : 'ç»§ç»­'}}
        </button>
        <button class="control-btn secondary" bindtap="restartGame">
          é‡æ–°å¼€å§‹
        </button>
      </view>

      <view class="control-row">
        <button class="control-btn hint {{hintUsed ? 'used' : ''}}" bindtap="getHint" disabled="{{!isGameActive || isShowingHint}}">
          <text class="hint-icon">ğŸ’¡</text>
          <text class="hint-text">{{isShowingHint ? 'æç¤ºä¸­...' : 'è·å–æç¤º'}}</text>
          <text class="hint-count" wx:if="{{hintsUsed > 0}}">({{hintsUsed}})</text>
        </button>
      </view>

      <button class="control-btn primary full-width" bindtap="backToMenu">
        è¿”å›èœå•
      </button>
    </view>

    <!-- æç¤ºæ˜¾ç¤ºåŒºåŸŸ -->
    <view class="hint-display {{showHint ? 'show' : ''}}" wx:if="{{currentHint}}">
      <view class="hint-content">
        <view class="hint-header">
          <text class="hint-title">ğŸ’¡ æ™ºèƒ½æç¤º</text>
          <view class="hint-close" bindtap="closeHint">âœ•</view>
        </view>
        <view class="hint-message">
          <text class="hint-step">{{currentHint.message}}</text>
          <view class="hint-detail" wx:if="{{currentHint.detail}}">
            <text>{{currentHint.detail}}</text>
          </view>
        </view>
        <view class="hint-actions">
          <button class="hint-btn apply" bindtap="applyHint" wx:if="{{currentHint.canApply}}">
            è‡ªåŠ¨æ‰§è¡Œ
          </button>
          <button class="hint-btn close" bindtap="closeHint">
            çŸ¥é“äº†
          </button>
        </view>
      </view>
    </view>
  </view>

  <!-- å®Œæˆç•Œé¢ -->
  <view class="game-completed" wx:if="{{gameState === 'completed'}}">
    <view class="completion-animation">
      <view class="success-icon">ğŸ‰</view>
      <view class="success-title">æ­å–œå®Œæˆï¼</view>
    </view>

    <view class="completion-stats">
      <view class="stat-item">
        <view class="stat-label">å®Œæˆæ—¶é—´</view>
        <view class="stat-value">{{gameTime}}ç§’</view>
      </view>
      <view class="stat-item">
        <view class="stat-label">ä½¿ç”¨æ­¥æ•°</view>
        <view class="stat-value">{{moves}}æ­¥</view>
      </view>
      <view class="stat-item">
        <view class="stat-label">éš¾åº¦ç­‰çº§</view>
        <view class="stat-value">{{puzzleSize}}Ã—{{puzzleSize}}</view>
      </view>
      <view class="stat-item" wx:if="{{hintsUsed > 0}}">
        <view class="stat-label">ä½¿ç”¨æç¤º</view>
        <view class="stat-value">{{hintsUsed}}æ¬¡</view>
      </view>
    </view>

    <view class="puzzle-container completed">
      <view class="puzzle-grid" style="grid-template-columns: repeat({{puzzleSize}}, 1fr);">
        <block wx:for="{{puzzleGrid}}" wx:for-index="rowIndex" wx:key="rowIndex">
          <block wx:for="{{item}}" wx:for-index="colIndex" wx:for-item="cellValue" wx:key="colIndex">
            <view class="puzzle-tile completed {{cellValue === 0 ? 'empty' : ''}}">
              <text wx:if="{{cellValue !== 0}}">{{cellValue}}</text>
            </view>
          </block>
        </block>
      </view>
    </view>

    <view class="completion-actions">
      <button class="action-btn secondary" bindtap="startGame">
        å†æ¥ä¸€å±€
      </button>
      <button class="action-btn primary" bindtap="backToMenu">
        è¿”å›èœå•
      </button>
    </view>
  </view>
</view>
