<view class="container" style="--theme-color: {{themeColor}}">
  <view class="header">
    <navigator url="/pages/settings/settings" open-type="navigateBack" hover-class="none">
      <view class="back-icon">
        <image src="/images/back.png" mode="aspectFit"></image>
      </view>
    </navigator>
    <text class="title">周易算命</text>
    <view class="history-btn" bindtap="viewHistory">
      <text>📜</text>
    </view>
  </view>

  <!-- 输入信息步骤 -->
  <view class="step-content" wx:if="{{currentStep === 'input'}}">
    <view class="intro-section">
      <view class="intro-icon">🔮</view>
      <view class="intro-text">
        <text class="intro-title">周易算命</text>
        <text class="intro-desc">基于传统周易理论，结合现代AI技术，为您提供客观均衡的命理分析</text>
      </view>
    </view>

    <view class="form-section">
      <view class="form-group">
        <text class="form-label">姓名</text>
        <input class="form-input" 
               value="{{userInfo.name}}" 
               bindinput="inputName" 
               placeholder="请输入您的姓名" />
      </view>

      <view class="form-group">
        <text class="form-label">性别</text>
        <view class="gender-selector">
          <view class="gender-item {{userInfo.gender === 'male' ? 'active' : ''}}" 
                bindtap="selectGender" 
                data-gender="male">
            <text>👨 男</text>
          </view>
          <view class="gender-item {{userInfo.gender === 'female' ? 'active' : ''}}" 
                bindtap="selectGender" 
                data-gender="female">
            <text>👩 女</text>
          </view>
        </view>
      </view>

      <view class="form-group">
        <text class="form-label">出生日期</text>
        <picker mode="date" 
                value="{{userInfo.birthDate}}" 
                bindchange="inputBirthDate">
          <view class="picker-input">
            {{userInfo.birthDate || '请选择出生日期'}}
          </view>
        </picker>
      </view>

      <view class="form-group">
        <text class="form-label">出生时辰</text>
        <picker range="{{timeOptions}}" 
                value="{{selectedTimeIndex}}" 
                bindchange="selectBirthTime">
          <view class="picker-input">
            {{userInfo.birthTime || '请选择出生时辰'}}
          </view>
        </picker>
      </view>

      <view class="form-group">
        <text class="form-label">占卜问题</text>
        <textarea class="form-textarea" 
                  value="{{userInfo.question}}" 
                  bindinput="inputQuestion" 
                  placeholder="请输入您想要占卜的具体问题，如：事业发展、感情婚姻、财运状况等"
                  maxlength="200"></textarea>
      </view>

      <button class="start-btn" bindtap="startDivination">
        开始算命
      </button>
    </view>
  </view>

  <!-- 加载步骤 -->
  <view class="step-content loading-content" wx:if="{{currentStep === 'loading'}}">
    <view class="loading-animation">
      <view class="bagua-container">
        <view class="bagua-symbol">☯</view>
      </view>
      <view class="loading-text">
        <text class="loading-title">正在为您算命...</text>
        <text class="loading-desc">大师正在根据您的八字信息进行推算</text>
      </view>
    </view>
  </view>

  <!-- 结果步骤 -->
  <view class="step-content result-content" wx:if="{{currentStep === 'result' && divinationResult}}">
    <view class="result-header">
      <view class="result-title">
        <text class="title-icon">🔮</text>
        <text class="title-text">算命结果</text>
      </view>
      <view class="result-info">
        <text class="user-name">{{divinationResult.userInfo.name}}</text>
        <text class="divination-time">{{divinationResult.timestamp}}</text>
      </view>
    </view>

    <view class="result-sections">
      <!-- 八字命理 -->
      <view class="result-section" wx:if="{{divinationResult.content.bazi}}">
        <view class="section-title">
          <text class="section-icon">📊</text>
          <text>八字命理</text>
        </view>
        <view class="section-content">
          <text>{{divinationResult.content.bazi}}</text>
        </view>
      </view>

      <!-- 问题分析 -->
      <view class="result-section" wx:if="{{divinationResult.content.analysis}}">
        <view class="section-title">
          <text class="section-icon">🔍</text>
          <text>问题分析</text>
        </view>
        <view class="section-content">
          <text>{{divinationResult.content.analysis}}</text>
        </view>
      </view>

      <!-- 有利因素 -->
      <view class="result-section" wx:if="{{divinationResult.content.advantages}}">
        <view class="section-title">
          <text class="section-icon">✅</text>
          <text>有利因素</text>
        </view>
        <view class="section-content">
          <text>{{divinationResult.content.advantages}}</text>
        </view>
      </view>

      <!-- 挑战风险 -->
      <view class="result-section" wx:if="{{divinationResult.content.challenges}}">
        <view class="section-title">
          <text class="section-icon">⚠️</text>
          <text>注意事项</text>
        </view>
        <view class="section-content">
          <text>{{divinationResult.content.challenges}}</text>
        </view>
      </view>

      <!-- 建议 -->
      <view class="result-section" wx:if="{{divinationResult.content.suggestions}}">
        <view class="section-title">
          <text class="section-icon">💡</text>
          <text>改善建议</text>
        </view>
        <view class="section-content">
          <text>{{divinationResult.content.suggestions}}</text>
        </view>
      </view>

      <!-- 总体运势 -->
      <view class="result-section" wx:if="{{divinationResult.content.overall}}">
        <view class="section-title">
          <text class="section-icon">🌟</text>
          <text>总体运势</text>
        </view>
        <view class="section-content">
          <text>{{divinationResult.content.overall}}</text>
        </view>
      </view>
    </view>

    <view class="result-summary">
      <view class="summary-title">总结</view>
      <view class="summary-content">
        <text>{{divinationResult.summary}}</text>
      </view>
    </view>

    <view class="result-actions">
      <button class="action-btn secondary" bindtap="resetDivination">
        重新算命
      </button>
      <button class="action-btn primary" bindtap="viewHistory">
        查看历史
      </button>
    </view>
  </view>

  <!-- 免责声明 -->
  <view class="disclaimer">
    <text>* 算命结果仅供娱乐参考，不构成任何决策建议</text>
  </view>
</view>
