<view class="container" style="--theme-color: {{themeColor}}">
  <view class="header">
    <navigator url="/pages/settings/settings" open-type="navigateBack" hover-class="none">
      <view class="back-icon">
        <image src="/images/back.png" mode="aspectFit"></image>
      </view>
    </navigator>
    <text class="title">å‘¨æ˜“ç®—å‘½</text>
    <view class="history-btn" bindtap="viewHistory">
      <text>ğŸ“œ</text>
    </view>
  </view>

  <!-- è¾“å…¥ä¿¡æ¯æ­¥éª¤ -->
  <view class="step-content" wx:if="{{currentStep === 'input'}}">
    <view class="intro-section">
      <view class="intro-icon">ğŸ”®</view>
      <view class="intro-text">
        <text class="intro-title">å‘¨æ˜“ç®—å‘½</text>
        <text class="intro-desc">åŸºäºä¼ ç»Ÿå‘¨æ˜“ç†è®ºï¼Œç»“åˆç°ä»£AIæŠ€æœ¯ï¼Œä¸ºæ‚¨æä¾›å®¢è§‚å‡è¡¡çš„å‘½ç†åˆ†æ</text>
      </view>
    </view>

    <view class="form-section">
      <view class="form-group">
        <text class="form-label">å§“å</text>
        <input class="form-input" 
               value="{{userInfo.name}}" 
               bindinput="inputName" 
               placeholder="è¯·è¾“å…¥æ‚¨çš„å§“å" />
      </view>

      <view class="form-group">
        <text class="form-label">æ€§åˆ«</text>
        <view class="gender-selector">
          <view class="gender-item {{userInfo.gender === 'male' ? 'active' : ''}}" 
                bindtap="selectGender" 
                data-gender="male">
            <text>ğŸ‘¨ ç”·</text>
          </view>
          <view class="gender-item {{userInfo.gender === 'female' ? 'active' : ''}}" 
                bindtap="selectGender" 
                data-gender="female">
            <text>ğŸ‘© å¥³</text>
          </view>
        </view>
      </view>

      <view class="form-group">
        <text class="form-label">å‡ºç”Ÿæ—¥æœŸ</text>
        <picker mode="date" 
                value="{{userInfo.birthDate}}" 
                bindchange="inputBirthDate">
          <view class="picker-input">
            {{userInfo.birthDate || 'è¯·é€‰æ‹©å‡ºç”Ÿæ—¥æœŸ'}}
          </view>
        </picker>
      </view>

      <view class="form-group">
        <text class="form-label">å‡ºç”Ÿæ—¶è¾°</text>
        <picker range="{{timeOptions}}" 
                value="{{selectedTimeIndex}}" 
                bindchange="selectBirthTime">
          <view class="picker-input">
            {{userInfo.birthTime || 'è¯·é€‰æ‹©å‡ºç”Ÿæ—¶è¾°'}}
          </view>
        </picker>
      </view>

      <view class="form-group">
        <text class="form-label">å åœé—®é¢˜</text>
        <textarea class="form-textarea" 
                  value="{{userInfo.question}}" 
                  bindinput="inputQuestion" 
                  placeholder="è¯·è¾“å…¥æ‚¨æƒ³è¦å åœçš„å…·ä½“é—®é¢˜ï¼Œå¦‚ï¼šäº‹ä¸šå‘å±•ã€æ„Ÿæƒ…å©šå§»ã€è´¢è¿çŠ¶å†µç­‰"
                  maxlength="200"></textarea>
      </view>

      <button class="start-btn" bindtap="startDivination">
        å¼€å§‹ç®—å‘½
      </button>
    </view>
  </view>

  <!-- åŠ è½½æ­¥éª¤ -->
  <view class="step-content loading-content" wx:if="{{currentStep === 'loading'}}">
    <view class="loading-animation">
      <view class="bagua-container">
        <view class="bagua-symbol">â˜¯</view>
      </view>
      <view class="loading-text">
        <text class="loading-title">æ­£åœ¨ä¸ºæ‚¨ç®—å‘½...</text>
        <text class="loading-desc">å¤§å¸ˆæ­£åœ¨æ ¹æ®æ‚¨çš„å…«å­—ä¿¡æ¯è¿›è¡Œæ¨ç®—</text>
      </view>
    </view>
  </view>

  <!-- ç»“æœæ­¥éª¤ -->
  <view class="step-content result-content" wx:if="{{currentStep === 'result' && divinationResult}}">
    <view class="result-header">
      <view class="result-title">
        <text class="title-icon">ğŸ”®</text>
        <text class="title-text">ç®—å‘½ç»“æœ</text>
      </view>
      <view class="result-info">
        <text class="user-name">{{divinationResult.userInfo.name}}</text>
        <text class="divination-time">{{divinationResult.timestamp}}</text>
      </view>
    </view>

    <view class="result-sections">
      <!-- å…«å­—å‘½ç† -->
      <view class="result-section" wx:if="{{divinationResult.content.bazi}}">
        <view class="section-title">
          <text class="section-icon">ğŸ“Š</text>
          <text>å…«å­—å‘½ç†</text>
        </view>
        <view class="section-content">
          <text>{{divinationResult.content.bazi}}</text>
        </view>
      </view>

      <!-- é—®é¢˜åˆ†æ -->
      <view class="result-section" wx:if="{{divinationResult.content.analysis}}">
        <view class="section-title">
          <text class="section-icon">ğŸ”</text>
          <text>é—®é¢˜åˆ†æ</text>
        </view>
        <view class="section-content">
          <text>{{divinationResult.content.analysis}}</text>
        </view>
      </view>

      <!-- æœ‰åˆ©å› ç´  -->
      <view class="result-section" wx:if="{{divinationResult.content.advantages}}">
        <view class="section-title">
          <text class="section-icon">âœ…</text>
          <text>æœ‰åˆ©å› ç´ </text>
        </view>
        <view class="section-content">
          <text>{{divinationResult.content.advantages}}</text>
        </view>
      </view>

      <!-- æŒ‘æˆ˜é£é™© -->
      <view class="result-section" wx:if="{{divinationResult.content.challenges}}">
        <view class="section-title">
          <text class="section-icon">âš ï¸</text>
          <text>æ³¨æ„äº‹é¡¹</text>
        </view>
        <view class="section-content">
          <text>{{divinationResult.content.challenges}}</text>
        </view>
      </view>

      <!-- å»ºè®® -->
      <view class="result-section" wx:if="{{divinationResult.content.suggestions}}">
        <view class="section-title">
          <text class="section-icon">ğŸ’¡</text>
          <text>æ”¹å–„å»ºè®®</text>
        </view>
        <view class="section-content">
          <text>{{divinationResult.content.suggestions}}</text>
        </view>
      </view>

      <!-- æ€»ä½“è¿åŠ¿ -->
      <view class="result-section" wx:if="{{divinationResult.content.overall}}">
        <view class="section-title">
          <text class="section-icon">ğŸŒŸ</text>
          <text>æ€»ä½“è¿åŠ¿</text>
        </view>
        <view class="section-content">
          <text>{{divinationResult.content.overall}}</text>
        </view>
      </view>
    </view>

    <view class="result-summary">
      <view class="summary-title">æ€»ç»“</view>
      <view class="summary-content">
        <text>{{divinationResult.summary}}</text>
      </view>
    </view>

    <view class="result-actions">
      <button class="action-btn secondary" bindtap="resetDivination">
        é‡æ–°ç®—å‘½
      </button>
      <button class="action-btn primary" bindtap="viewHistory">
        æŸ¥çœ‹å†å²
      </button>
    </view>
  </view>

  <!-- å…è´£å£°æ˜ -->
  <view class="disclaimer">
    <text>* ç®—å‘½ç»“æœä»…ä¾›å¨±ä¹å‚è€ƒï¼Œä¸æ„æˆä»»ä½•å†³ç­–å»ºè®®</text>
  </view>
</view>
