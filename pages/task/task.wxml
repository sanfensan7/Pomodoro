<view class="container" style="--theme-color: {{themeColor}}">
  <view class="header">
    <text class="title">ä»»åŠ¡ç®¡ç†</text>
    <view class="header-actions">
      <view class="sort-btn" bindtap="toggleSortMenu">
        <text class="sort-icon">â‡…</text>
      </view>
      <view class="add-icon" bindtap="toggleTaskForm">
        <text>+</text>
      </view>
    </view>
  </view>

  <!-- æ’åºèœå• -->
  <view class="sort-menu {{showSortMenu ? 'show' : ''}}" wx:if="{{showSortMenu}}">
    <view class="sort-option" bindtap="sortTasks" data-type="createTime">æŒ‰åˆ›å»ºæ—¶é—´</view>
    <view class="sort-option" bindtap="sortTasks" data-type="priority">æŒ‰ä¼˜å…ˆçº§</view>
    <view class="sort-option" bindtap="sortTasks" data-type="progress">æŒ‰è¿›åº¦</view>
    <view class="sort-option" bindtap="sortTasks" data-type="name">æŒ‰åç§°</view>
  </view>
  
  <view class="task-list">
    <block wx:for="{{tasks}}" wx:key="id">
      <view class="task-item {{item.completed ? 'completed' : ''}}">
        <view class="task-checkbox {{item.completed ? 'completed' : ''}}"
              style="border-color: {{themeColor}}; {{item.completed ? 'background-color:' + themeColor : ''}}"
              data-id="{{item.id}}" bindtap="toggleTaskStatus">
          <icon wx:if="{{item.completed}}" type="success" size="16" color="#fff"></icon>
        </view>
        <view class="task-content" bindtap="startFocus" data-task="{{item}}">
          <view class="task-header">
            <view class="task-title-section">
              <text class="task-title">{{item.title}}</text>
              <view class="task-meta">
                <text class="priority-badge priority-{{item.priority || 'medium'}}">{{item.priority === 'high' ? 'é«˜' : item.priority === 'low' ? 'ä½' : 'ä¸­'}}</text>
                <text class="category-badge category-{{item.category || 'other'}}">{{item.category === 'work' ? 'å·¥ä½œ' : item.category === 'study' ? 'å­¦ä¹ ' : item.category === 'life' ? 'ç”Ÿæ´»' : 'å…¶ä»–'}}</text>
              </view>
            </view>
          </view>
          <view class="task-description" wx:if="{{item.description}}">{{item.description}}</view>
          <view class="task-progress">
            <view class="progress-text">å®Œæˆè¿›åº¦ï¼š{{item.completedCount}}/{{item.totalCount}}</view>
            <view class="start-focus" style="color: {{themeColor}}">
              <image src="/images/play.png" mode="aspectFit"></image>
              <text>å¼€å§‹ä¸“æ³¨</text>
            </view>
          </view>
        </view>
        <view class="task-actions">
          <view class="action-btn edit-btn" bindtap="editTask" data-task="{{item}}">
            <text class="action-icon">âœ</text>
          </view>
          <view class="action-btn delete-btn" bindtap="deleteTask" data-id="{{item.id}}">
            <text class="action-icon">ğŸ—‘</text>
          </view>
        </view>
      </view>
    </block>
    
    <view class="add-task-btn" bindtap="toggleTaskForm">
      <text>+ æ·»åŠ æ–°ä»»åŠ¡</text>
    </view>
  </view>
  
  <!-- æ·»åŠ /ç¼–è¾‘ä»»åŠ¡è¡¨å• -->
  <view class="task-form {{showTaskForm ? 'show' : ''}}">
    <view class="form-header">
      <text>{{editingTask ? 'ç¼–è¾‘ä»»åŠ¡' : 'æ–°ä»»åŠ¡'}}</text>
      <view class="close-btn" bindtap="toggleTaskForm">Ã—</view>
    </view>
    <view class="form-group">
      <text class="form-label">ä»»åŠ¡åç§°</text>
      <input class="form-input" value="{{newTask.title}}" bindinput="inputTaskTitle" placeholder="è¾“å…¥ä»»åŠ¡åç§°" />
    </view>
    <view class="form-group">
      <text class="form-label">ä»»åŠ¡æè¿°</text>
      <textarea class="form-textarea" value="{{newTask.description}}" bindinput="inputTaskDescription" placeholder="è¾“å…¥ä»»åŠ¡æè¿°"></textarea>
    </view>
    <view class="form-group">
      <text class="form-label">ä¼˜å…ˆçº§</text>
      <view class="priority-selector">
        <view class="priority-item {{newTask.priority === 'high' ? 'active' : ''}}" bindtap="setPriority" data-priority="high">
          <text class="priority-dot high"></text>
          <text>é«˜</text>
        </view>
        <view class="priority-item {{newTask.priority === 'medium' ? 'active' : ''}}" bindtap="setPriority" data-priority="medium">
          <text class="priority-dot medium"></text>
          <text>ä¸­</text>
        </view>
        <view class="priority-item {{newTask.priority === 'low' ? 'active' : ''}}" bindtap="setPriority" data-priority="low">
          <text class="priority-dot low"></text>
          <text>ä½</text>
        </view>
      </view>
    </view>
    <view class="form-group">
      <text class="form-label">åˆ†ç±»æ ‡ç­¾</text>
      <view class="tag-selector">
        <view class="tag-item {{newTask.category === 'work' ? 'active' : ''}}" bindtap="setCategory" data-category="work">å·¥ä½œ</view>
        <view class="tag-item {{newTask.category === 'study' ? 'active' : ''}}" bindtap="setCategory" data-category="study">å­¦ä¹ </view>
        <view class="tag-item {{newTask.category === 'life' ? 'active' : ''}}" bindtap="setCategory" data-category="life">ç”Ÿæ´»</view>
        <view class="tag-item {{newTask.category === 'other' ? 'active' : ''}}" bindtap="setCategory" data-category="other">å…¶ä»–</view>
      </view>
    </view>
    <view class="form-group">
      <text class="form-label">é¢„è®¡ç•ªèŒ„æ•°</text>
      <slider min="1" max="20" value="{{newTask.totalCount}}" bindchange="changeTaskCount" show-value />
    </view>
    <view class="form-actions">
      <button class="btn-cancel" bindtap="toggleTaskForm">å–æ¶ˆ</button>
      <button class="btn-submit" style="background-color: {{themeColor}}" bindtap="{{editingTask ? 'updateTask' : 'addTask'}}">{{editingTask ? 'æ›´æ–°' : 'æ·»åŠ '}}</button>
    </view>
  </view>
  
  <!-- é®ç½©å±‚ -->
  <view class="mask" wx:if="{{showTaskForm}}" bindtap="toggleTaskForm"></view>
</view> 